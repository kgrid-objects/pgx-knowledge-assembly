<!DOCTYPE html>
<html>

<head>

  <!-- <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/> -->
  <link rel="stylesheet" href="static/css/bootstrap.min.css" />
  <!-- <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/> -->
  <link rel="stylesheet" href="static/css/bootstrap-vue.css" />
  <link rel="stylesheet" href="static/css/ca_style.css" />
  <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="static/css/all.css" />
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script> -->
  <script src="/static/js/moment.min.js"></script>
  <!-- <script src="https://unpkg.com/lodash"></script> -->
  <script src="./static/js/lodash.js"></script>
  <!-- <script src="https://unpkg.com/vue"></script> -->
  <script src="./static/js/vue.js"></script>
  <!-- <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script> -->
  <script src="./static/js/polyfill.min.js"></script>
  <!-- <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script> -->
  <script src="./static/js/bootstrap-vue.js"></script>
  <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
  <script src="./static/js/axios.min.js"></script>
  <title>Pharmacogenomics Demo App</title>
  <style>
    .nav-tabs .nav-link {
      cursor: pointer;
    }

    .nav-tabs .nav-link.active {
      background-color: #7b7e81;
      color: #fff;
    }

    .card {
      border-radius: 10px;
      background-color: #fff;
    }

    .btn.btn-primary:focus,
    .btn.btn-primary:active,
    .btn.btn-primary:visited {
      background-color: #007bff !important;
      color: #fff !important;
      border-color: #007bff !important;
      box-shadow: none !important;
    }
  </style>
</head>

<body>
  <div id='app' style='position:relative;min-height:100vh;padding-bottom:0.5px;'>
    <header>
      <div class="container color-scheme pad-l-30 header-title noselect">
        <h1>Pharmacogenomics Demo App
          <!-- <div class='float-r'>
            <i class="fas fa-cog" id='settingicon' @click='showsetting'></i>
            <a href='https://demo.kgrid.org/cpic-demo#web-demo' target="_blank" style='color:#666;'><i class="fas fa-info-circle" ></i></a>
          </div> -->
        </h1>
      </div>
    </header>
    <div class="container">
      <div class="row gene-row">
        <div class="col-md-4 pad-l-0 pad-r-0">
          <div class="ht-g input_div">
            <div class=" box-header color-scheme">
              <div class="row">
                <div class="col-md-12 col-sm-12 noselect" style="line-height:3em;font-weight:500;"><span>Gene Phenotype
                    Panel</span></div>
                <div class="col-md-12 col-sm-12">
                  <div class="radio-group">
                    <input type="radio" id="option-zero" value="0" name="patient" v-model='autofillSelection'> <label
                      class="noselect" for="option-zero">Patient 1</label>
                    <input type="radio" id="option-one" value="1" name="patient" v-model='autofillSelection'> <label
                      class="noselect" for="option-one">Patient 2</label>
                    <input type="radio" id="option-two" value="2" name="patient" v-model='autofillSelection'> <label
                      class="noselect" for="option-two">Patient 3</label>
                    <input type="radio" id="option-three" value="3" name="patient" v-model='autofillSelection'> <label
                      class="noselect" for="option-three">Patient 4</label>
                    <input type="radio" id="option-four" value="4" name="patient" v-model='autofillSelection'> <label
                      class="noselect" for="option-four">Patient 5</label>
                  </div>
                </div>
              </div>
            </div>
            <table class='gene-table'>
              <tbody>
                <tr class='noselect'>
                  <th>Gene</th>
                  <th>Diplotype</th>
                  <th>Phenotype</th>
                </tr>
                <tr class=" " v-for='(value, key) in diplotypePanel'>
                  <td class='noselect' :class="{active:value!=''}" :id='key' style='width:20%;'>
                    <a v-if="key !== 'HLA-A' && key !== 'HLA-B'" :href="'https://kgrid-objects.github.io/pgx-knowledge-assembly/CPIC_Phenotype_' + key"
                      target="_blank" rel="noopener" class="info-link"
                      style='margin-left:8px;color:inherit;text-decoration:none;'>
                      <i class="fas fa-info-circle" aria-hidden="true"></i>
                      <span class="sr-only">More info about {{key}}</span>
                    </a>
                    <span v-else style="display:inline-block; width:18px;"></span>
                    {{key}}
                  </td>
                  <td :class="{active:value!=''}" style='width:25%;'> <b-form-input type="text"
                      v-model='diplotypePanel[key]'></b-form-input> </td>
                  <td class='pheno noselect' style='width:30%;font-size:85%;text-align:center;'
                    :class="{active:value!=''}"><span
                      v-if='phenotypePanel[key].phenotype!=""'>{{phenotypePanel[key].phenotype}}</span><span
                      v-else>---</span></td>
                </tr>
              </tbody>
            </table>
            <div class="container mt-4">
              <div class="panel card shadow p-3">
                <ul class="nav nav-tabs" style="font-weight: 500;">
                  <li class="nav-item">
                    <a class="nav-link" :class="{ active: activeTab === 'assembly' }" href="#"
                      @click.prevent="activeTab = 'assembly'">
                      Knowledge Assembly
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" :class="{ active: activeTab === 'chatbot' }" href="#"
                      @click.prevent="activeTab = 'chatbot'">
                      Chatbot
                    </a>
                  </li>
                </ul>

                <div class="tab-content mt-3">
                  <!-- Knowledge Assembly Tab -->
                  <div v-if="activeTab === 'assembly'">
                    <p>
                      This app uses the following knowledge assembly
                    <ul>
                      <li>Title: <b>Pharmagenomics Knowledge Assembly</b></li>
                      <li>Version: <b>v1.0</b></li>
                      <li>Date: <b>2025-05-06</b></li>
                    </ul>

                    </p>
                    <button class="btn btn-primary" @click="openAssemblyLink">
                      Knowledge Assembly Info Page
                    </button>
                  </div>

                  <!-- Chatbot Tab -->
                  <div v-if="activeTab === 'chatbot'">
                    <iframe :src="chatbotUrl" style="width:100%;height:400px;border:2px solid #ccc;border-radius:8px;"
                      loading="lazy"></iframe>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CPIC Recommendations Column -->
        <div class="col-md-4 col-sm-12 viewtop ht-d noselect">
          <h4 class="pad-25 align-c">CPIC Recommendations</h4>
          <div class="tab-pane active">
            <ul id="reclist"
              style="list-style:none;width:100%;overflow-y:auto;text-align:left;font-size:18px;padding:0;margin:0;">
              <li v-for="(rec, index) in recommendationlistks2">
                <recomtile :recmodel="rec" :reckey="rec.result.drug" :recindex="index" :recsource="'CPIC'">
                </recomtile>
              </li>
            </ul>
          </div>
        </div>

        <!-- DPWG Recommendations Column -->
        <div class="col-md-4 col-sm-12 viewtop ht-d noselect">
          <h4 class="pad-25 align-c">DPWG Recommendations</h4>
          <div class="tab-pane active">
            <ul id="reclistdpwg"
              style="list-style:none;width:100%;overflow-y:auto;text-align:left;font-size:18px;padding:0;margin:0;">
              <li v-for="(rec, index) in recommendationlistks3">
                <recomtile :recmodel="rec" :reckey="rec.result.drug" :recindex="index" :recsource="'DPWG'">
                </recomtile>
              </li>
            </ul>
          </div>
        </div>

      </div>
    </div>
    <div class="container">
      <div class="row statussec noselect align-items-center">
        <div class="col-auto">
          <ul class="nav nav-tabs" role="tablist" style="margin:0;font-weight: 500;">
            <li class="nav-item">
              <a class="nav-link" :class="{ active: currentView === 'RAW_DATA' }" href="#" @click.prevent="showLogSection('SEE RAW DATA')">RAW DATA</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" :class="{ active: currentView === 'RAW_OUTPUT' }" href="#" @click.prevent="showLogSection('SEE RAW OUTPUT')">RAW OUTPUT</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" :class="{ active: currentView === 'LOG' }" href="#" @click.prevent="showLogSection('LOG')">LOG</a>
            </li>
          </ul>
        </div>
        <b-collapse id="collapsestatus" v-model="isLogOpen">
        <div id='statuslog'>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 12px;border-bottom:1px solid #eee;">

            <div>
              <button v-if="currentView" @click="copyContent" class="btn btn-sm" title="Copy" style="border:1px solid #ddd;background:#fff;color:#444;padding:4px 8px;border-radius:4px;">
                <i class="fas fa-copy"></i>
                <span class="sr-only">Copy</span>
              </button>
            </div>
          </div>
          <div v-if="currentView === 'LOG'">
            <ul id='eventlog' style='list-style:none;max-height:800px;overflow:auto;padding:8px;'>
              <li v-for='entry in eventlog' :class='entry.key'>{{entry.timestamp}} <span>{{entry.text}}</span> </li>
            </ul>
          </div>
          <div v-else-if="currentView === 'RAW_DATA'" style="padding:12px;">
            <pre id="raw-data-pre" style="white-space:pre-wrap;text-align:left;max-height:800px;overflow:auto;background:#fafafa;padding:12px;border-radius:6px;border:1px solid #eee;">{{ rawDataJson }}</pre>
          </div>
          <div v-else-if="currentView === 'RAW_OUTPUT'" style="padding:12px;">
            <pre id="raw-output-pre" style="white-space:pre-wrap;text-align:left;max-height:800px;overflow:auto;background:#fafafa;padding:12px;border-radius:6px;border:1px solid #eee;">{{ rawOutputJson }}</pre>
          </div>
          <div v-else style="padding:20px;text-align:center;">
            <div style="font-size:1.1rem;font-weight:500;">{{logSectionTitle}}</div>
          </div>
        </div>
      </b-collapse>
      </div>
    </div>

  </div>
      <footer class="container-fluid container-car color-scheme text-center">
      <p>University of Michigan Medical School 2025</p>
    </footer>
  <template id='recomtile-template'>
    <div v-bind:id="recindex">
      <div class="row kg-sub">
        <div class="col-md-11 col-sm-11 col-xs-11 kgl-title kg-fg-color" data-toggle="tooltip" data-placement="top"
          v-bind:title="recmodel.status"><span>{{reckey}} </span>
          <a :href="objlink" target="_blank" rel="noopener" class="info-link"
            style='margin-left:8px;color:inherit;text-decoration:none;'>
            <i class="fas fa-info-circle" aria-hidden="true"></i>
            <span class="sr-only">More info about {{reckey}}</span>
          </a>
        </div>
        <!-- <a :href='objlink' target="_blank" style='color:#fff;float:right;font-size:80%;'><i class="fas fa-info-circle" ></i></a> -->
      </div>
      <div class="row kg-rec pad-top10" v-for='(value, key,index) in recrender'>
        <div class="col-md-4 col-sm-4 col-xs-4 ">
          <span><small>{{reclabel[key]}}</small></span>
        </div>
        <div class="col-md-8 col-sm-8 col-xs-8 ">
          <span>{{value}}</span>
        </div>
      </div>
    </div>
  </template>
</body>
<script type="module" src="/public/static/js/cpic.js"> </script>

</html>